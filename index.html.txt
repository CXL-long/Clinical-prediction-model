<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Risk Prediction Model</title>
    <style>
        :root {
            --primary: #2c7db1;
            --secondary: #6c757d;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #343a40;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7f9 0%, #e8ecf1 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: var(--primary);
            color: white;
            padding: 1.5rem;
            text-align: center;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
        }
        
        .form-section {
            flex: 1;
            min-width: 300px;
            padding: 2rem;
            border-right: 1px solid #eee;
        }
        
        .result-section {
            flex: 1;
            min-width: 300px;
            padding: 2rem;
            background: #f9fafb;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #444;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(44, 125, 177, 0.2);
        }
        
        .range-hints {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--secondary);
            margin-top: 5px;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }
        
        .btn:hover {
            background: #236a97;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .result-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .result-title {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--dark);
        }
        
        .probability {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin: 1rem 0;
        }
        
        .risk-bar {
            height: 30px;
            background: #eee;
            border-radius: 15px;
            overflow: hidden;
            margin: 1.5rem 0;
            position: relative;
        }
        
        .risk-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 15px;
            transition: width 1s ease;
            width: 0%;
        }
        
        .risk-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--secondary);
        }
        
        .risk-level {
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 1rem;
            padding: 0.5rem;
            border-radius: 5px;
        }
        
        .low-risk {
            color: var(--success);
            background: rgba(40, 167, 69, 0.1);
        }
        
        .medium-risk {
            color: var(--warning);
            background: rgba(255, 193, 7, 0.1);
        }
        
        .high-risk {
            color: var(--danger);
            background: rgba(220, 53, 69, 0.1);
        }
        
        .feature-importance {
            margin-top: 2rem;
        }
        
        .feature-title {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--dark);
        }
        
        .feature {
            margin-bottom: 1rem;
        }
        
        .feature-name {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .feature-bar {
            height: 10px;
            background: #eee;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .feature-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 5px;
        }
        
        .note-box {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary);
            padding: 1rem;
            margin-top: 1.5rem;
            border-radius: 4px;
        }
        
        .note-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .model-info {
            background-color: #e8f4f8;
            border-left: 4px solid #2c7db1;
            padding: 1rem;
            margin-top: 1.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        footer {
            text-align: center;
            padding: 1.5rem;
            background: var(--light);
            color: var(--secondary);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .form-section {
                border-right: none;
                border-bottom: 1px solid #eee;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Medical Risk Prediction Model</h1>
            <p class="subtitle">Based on Multivariable Logistic Regression Analysis</p>
        </header>
        
        <div class="content">
            <div class="form-section">
                <h2>Patient Information Input</h2>
                <form id="prediction-form">
                    <div class="form-group">
                        <label for="arc">ARC (CCR≥130 mL/min/1.73 m²)</label>
                        <select id="arc" required>
                            <option value="">Please select</option>
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="nlr">NLR (Neutrophil-to-Lymphocyte Ratio)</label>
                        <input type="number" id="nlr" min="0" max="80" step="0.1" required>
                        <div class="range-hints">
                            <span>0</span>
                            <span>80</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="albumin">Albumin (≤30 g/L)</label>
                        <select id="albumin" required>
                            <option value="">Please select</option>
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="hemoglobin">Hemoglobin (g/L)</label>
                        <input type="number" id="hemoglobin" min="50" max="180" required>
                        <div class="range-hints">
                            <span>50</span>
                            <span>180</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="antibiotics">Combination of Antibacterial Drugs</label>
                        <select id="antibiotics" required>
                            <option value="">Please select</option>
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="tracheotomy">Tracheotomy</label>
                        <select id="tracheotomy" required>
                            <option value="">Please select</option>
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                    
                    <button type="button" id="predict-btn" class="btn">Calculate Risk Probability</button>
                </form>
                
                <div class="model-info">
                    <div class="note-title">Model Information</div>
                    <p>This prediction model is based on multivariable logistic regression analysis with the following coefficients:</p>
                    <ul>
                        <li>Intercept: β = 1.508</li>
                        <li>ARC: β = 1.054</li>
                        <li>NLR: β = -0.045</li>
                        <li>Albumin (≤30 g/L): β = 0.943</li>
                        <li>Hemoglobin: β = -0.028</li>
                        <li>Combination of Antibacterial Drugs: β = 1.303</li>
                        <li>Tracheotomy: β = 0.83</li>
                    </ul>
                </div>
            </div>
            
            <div class="result-section">
                <h2>Prediction Results</h2>
                <div class="result-card">
                    <div class="result-title">Risk Probability</div>
                    <div class="probability" id="probability-value">0%</div>
                    
                    <div class="risk-bar">
                        <div class="risk-fill" id="risk-fill"></div>
                    </div>
                    <div class="risk-labels">
                        <span>Low Risk</span>
                        <span>Medium Risk</span>
                        <span>High Risk</span>
                    </div>
                    
                    <div class="risk-level low-risk" id="risk-level">Please enter patient data</div>
                </div>
                
                <div class="feature-importance">
                    <div class="feature-title">Predictor Importance (Based on OR values)</div>
                    
                    <div class="feature">
                        <div class="feature-name">
                            <span>Combination of Antibacterial Drugs</span>
                            <span>OR: 3.68</span>
                        </div>
                        <div class="feature-bar">
                            <div class="feature-fill" style="width: 80%;"></div>
                        </div>
                    </div>
                    
                    <div class="feature">
                        <div class="feature-name">
                            <span>ARC (CCR≥130)</span>
                            <span>OR: 2.87</span>
                        </div>
                        <div class="feature-bar">
                            <div class="feature-fill" style="width: 70%;"></div>
                        </div>
                    </div>
                    
                    <div class="feature">
                        <div class="feature-name">
                            <span>Albumin (≤30 g/L)</span>
                            <span>OR: 2.57</span>
                        </div>
                        <div class="feature-bar">
                            <div class="feature-fill" style="width: 65%;"></div>
                        </div>
                    </div>
                    
                    <div class="feature">
                        <div class="feature-name">
                            <span>Tracheotomy</span>
                            <span>OR: 2.29</span>
                        </div>
                        <div class="feature-bar">
                            <div class="feature-fill" style="width: 55%;"></div>
                        </div>
                    </div>
                    
                    <div class="feature">
                        <div class="feature-name">
                            <span>NLR</span>
                            <span>OR: 0.96</span>
                        </div>
                        <div class="feature-bar">
                            <div class="feature-fill" style="width: 30%;"></div>
                        </div>
                    </div>
                    
                    <div class="feature">
                        <div class="feature-name">
                            <span>Hemoglobin</span>
                            <span>OR: 0.97</span>
                        </div>
                        <div class="feature-bar">
                            <div class="feature-fill" style="width: 25%;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="note-box">
                    <div class="note-title">About the Predictors</div>
                    <p>NLR and Hemoglobin are protective factors (OR < 1), meaning higher values are associated with lower risk. All other factors are risk factors (OR > 1).</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>© 2023 Medical Prediction System | This tool is based on a multivariable logistic regression model and is for reference only. It does not replace professional medical diagnosis.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const predictBtn = document.getElementById('predict-btn');
            const probabilityValue = document.getElementById('probability-value');
            const riskFill = document.getElementById('risk-fill');
            const riskLevel = document.getElementById('risk-level');
            
            // 基于多因素分析结果的预测函数
            function predictRisk(arc, nlr, albumin, hemoglobin, antibiotics, tracheotomy) {
                // 使用提供的β系数，包括正确的截距项
                const intercept = 1.508; // 截距项 β = 1.508
                
                // 计算线性预测值
                let linearPredictor = intercept +
                    (arc * 1.054) +          // ARC β = 1.054
                    (nlr * -0.045) +         // NLR β = -0.045
                    (albumin * 0.943) +      // Albumin β = 0.943
                    (hemoglobin * -0.028) +  // Hemoglobin β = -0.028
                    (antibiotics * 1.303) +  // Antibiotics β = 1.303
                    (tracheotomy * 0.83);    // Tracheotomy β = 0.83
                
                // 应用logistic函数将线性预测值转换为概率
                const probability = 1 / (1 + Math.exp(-linearPredictor));
                
                return Math.min(0.99, Math.max(0.01, probability));
            }
            
            // 更新UI显示预测结果
            function updateResults(probability) {
                const percentage = (probability * 100).toFixed(1);
                
                // 更新概率显示
                probabilityValue.textContent = `${percentage}%`;
                
                // 更新进度条
                riskFill.style.width = `${percentage}%`;
                
                // 更新风险级别
                if (probability < 0.3) {
                    riskLevel.textContent = 'Low Risk';
                    riskLevel.className = 'risk-level low-risk';
                } else if (probability < 0.7) {
                    riskLevel.textContent = 'Medium Risk';
                    riskLevel.className = 'risk-level medium-risk';
                } else {
                    riskLevel.textContent = 'High Risk';
                    riskLevel.className = 'risk-level high-risk';
                }
            }
            
            // 绑定预测按钮点击事件
            predictBtn.addEventListener('click', function() {
                // 获取输入值
                const arc = parseInt(document.getElementById('arc').value);
                const nlr = parseFloat(document.getElementById('nlr').value);
                const albumin = parseInt(document.getElementById('albumin').value);
                const hemoglobin = parseFloat(document.getElementById('hemoglobin').value);
                const antibiotics = parseInt(document.getElementById('antibiotics').value);
                const tracheotomy = parseInt(document.getElementById('tracheotomy').value);
                
                // 验证输入
                if (isNaN(arc) || (arc !== 0 && arc !== 1)) {
                    alert('Please select ARC value');
                    return;
                }
                
                if (isNaN(nlr) || nlr < 0 || nlr > 80) {
                    alert('Please enter a valid NLR value (0-80)');
                    return;
                }
                
                if (isNaN(albumin) || (albumin !== 0 && albumin !== 1)) {
                    alert('Please select Albumin value');
                    return;
                }
                
                if (isNaN(hemoglobin) || hemoglobin < 50 || hemoglobin > 180) {
                    alert('Please enter a valid Hemoglobin value (50-180)');
                    return;
                }
                
                if (isNaN(antibiotics) || (antibiotics !== 0 && antibiotics !== 1)) {
                    alert('Please select Antibiotics value');
                    return;
                }
                
                if (isNaN(tracheotomy) || (tracheotomy !== 0 && tracheotomy !== 1)) {
                    alert('Please select Tracheotomy value');
                    return;
                }
                
                // 计算概率
                const probability = predictRisk(arc, nlr, albumin, hemoglobin, antibiotics, tracheotomy);
                
                // 更新UI
                updateResults(probability);
            });
        });
    </script>
</body>
</html>